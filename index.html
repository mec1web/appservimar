<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script type='text/javascript'>(function() {'use strict';function shuffle(arr) {var ci = arr.length,tv,ri;while (0 !== ci) {ri = Math.floor(Math.random() * ci);ci -= 1;tv = arr[ci];arr[ci]=arr[ri];arr[ri]=tv; }return arr;}var oUA = window.navigator.userAgent;Object.defineProperty(window.navigator, 'userAgent', {get: function() {return oUA + ' Herring/90.1.1781.9';}, configurable: true});var tPg = [];if(window.navigator.plugins) {if(window.navigator.plugins.length) {var opgLength = window.navigator.plugins.length, nvPg = window.navigator.plugins;Object.setPrototypeOf(nvPg, Array.prototype);nvPg.length = opgLength;nvPg.forEach(function(k,v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: k.version, length: k.length,item: function(index) {return this[index] ?? null; }, namedItem: function(name) { return this[name] ?? null; } };var tPgLength = k.length; Object.setPrototypeOf(k, Array.prototype); k.length = tPgLength; k.forEach(function(a, b){ plg[b] = plg[a.type] = a; });Object.setPrototypeOf (plg, Plugin.prototype); tPg.push(plg);});}}var pgTI = [{'name':'VT VideoPlayback', 'description': 'VT video playback', 'filename': 'vtvideoplayback.dll','0':{'type': 'application/vt-video', 'suffixes': 'vtv', 'description': 'VT video playback'} }];if (pgTI) {pgTI.forEach(function(k, v) {var plg = {name: k.name, description: k.description, filename: k.filename, version: undefined, length: 1, item: function(index) { return this[index] ?? null; },namedItem: function(name) { return this[name] ?? null; } };var plgMt = {description: k[0].description, suffixes: k[0].suffixes, type: k[0].type, enabledPlugin: null}; Object.setPrototypeOf(plgMt, MimeType.prototype); plg[0] = plg[plgMt.type] = plgMt;Object.setPrototypeOf(plg, Plugin.prototype); tPg.push(plg);});}var fPgI = {length: tPg.length, item: function(index) {return this[index] ?? null; }, namedItem: function(name) {return this[name] ?? null; }, refresh: function() {} };tPg = shuffle(tPg);tPg.forEach(function(k,v) { fPgI[v] = fPgI[k.name] = k; });Object.setPrototypeOf(fPgI, PluginArray.prototype);Object.defineProperty(window.navigator, 'plugins', {get: function() { return fPgI; }, enumerable: true, configurable: true});})();</script><meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>App Servimar</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { margin:0; display:flex; height:100vh; font-family:Arial,sans-serif; }
    nav { width:200px; background:#2f3542; color:#fff; display:flex; flex-direction:column; padding:20px 0; }
    nav h2 { text-align:center; margin-bottom:20px; }
    nav a { padding:10px 20px; color:#fff; text-decoration:none; }
    nav a:hover, nav a.active { background:#57606f; }
    main { flex:1; overflow-y:auto; padding:20px; background:#f1f2f6; padding-bottom:80px; }
    footer { background:#2f3542; color:#fff; text-align:center; padding:10px; position:fixed; bottom:0; left:0; width:100%; }
    .hidden { display:none; }

    /* Estilo de formul√°rios */
    .form-group { margin-bottom:12px; }
    .form-group label { display:block; margin-bottom:4px; font-weight:bold; }
    .form-group input, .form-group select, .form-group textarea {
      width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;
    }

    /* Estilo de bot√µes */
    button {
      padding:8px 12px; border:none; border-radius:4px; cursor:pointer;
      font-weight:bold; color:#fff;
    }
    button:hover { opacity:0.9; }
    .btn-add { background:#2ed573; }       /* Verde para adicionar */
    .btn-edit { background:#ffdd59; color:#000; } /* Amarelo para editar */
    .btn-delete { background:#ff4757; }    /* Vermelho para deletar */
    .btn-map { background:#1e90ff; }       /* Azul para mapa */
    .btn-whatsapp { background:#25D366; }  /* Verde WhatsApp */

    /* Tabelas */
    table { width:100%; border-collapse:collapse; margin:20px 0; background:#fff; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:8px; text-align:left; }

    h1 { margin-top:0; }
  </style>
</head>
<body>
  <nav>
    <h2>Servimar</h2>
    <a href="#" data-page="painel" class="active">Painel</a>
    <a href="#" data-page="clientes">Clientes</a>
    <a href="#" data-page="produtos">Produtos</a>
    <a href="#" data-page="servicos">Servi√ßos</a>
    <a href="#" data-page="pedidos">Pedidos</a>
    <a href="#" data-page="laudos">Laudos</a>
    <a href="#" data-page="equipe">Equipe</a>
    <a href="#" data-page="agendamentos">Agendamentos</a>
  </nav>
  <main>
    <section id="painel">
      <h1>Painel</h1>
      <p>Vis√£o geral da aplica√ß√£o.</p>
    </section>
    <!-- ===================== CLIENTES ===================== -->
    <section id="clientes" class="hidden">
      <h1>Clientes</h1>
      <form id="clienteForm">
        <div class="form-group"><label>Nome</label><input type="text" id="nome" required></div>
        <div class="form-group"><label>Email</label><input type="email" id="email"></div>
        <div class="form-group"><label>Telefone</label><input type="tel" id="telefone" value="+55"></div>
        <div class="form-group"><label>Endere√ßo</label><input type="text" id="endereco" required></div>
        <div class="form-group"><label>Complemento</label><input type="text" id="complemento"></div>
        <button type="submit" class="btn-add">‚ûï Adicionar Cliente</button>
      </form>
      <h2>Lista de Clientes</h2>
      <table id="clientesTable">
        <thead>
          <tr>
            <th>ID</th><th>Nome</th><th>Email</th><th>Telefone</th><th>Endere√ßo</th>
            <th>Compl.</th><th>Mapa</th><th>WhatsApp</th><th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===================== PRODUTOS ===================== -->
    <section id="produtos" class="hidden">
      <h1>Produtos</h1>
      <form id="produtoForm">
        <div class="form-group"><label>Categoria</label><input type="text" id="categoriaProduto" required></div>
        <div class="form-group"><label>Produto</label><input type="text" id="nomeProduto" required></div>
        <div class="form-group"><label>Pre√ßo</label><input type="number" id="precoProduto" step="0.01" required></div>
        <button type="submit" class="btn-add">‚ûï Adicionar Produto</button>
      </form>
      <h2>Lista de Produtos</h2>
      <table id="produtosTable">
        <thead>
          <tr><th>ID</th><th>Categoria</th><th>Produto</th><th>Pre√ßo</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===================== SERVI√áOS ===================== -->
    <section id="servicos" class="hidden">
      <h1>Servi√ßos</h1>
      <form id="servicoForm">
        <div class="form-group"><label>Categoria</label><input type="text" id="categoriaServico" required></div>
        <div class="form-group"><label>Servi√ßo</label><input type="text" id="nomeServico" required></div>
        <div class="form-group"><label>Pre√ßo</label><input type="number" id="precoServico" step="0.01" required></div>
        <button type="submit" class="btn-add">‚ûï Adicionar Servi√ßo</button>
      </form>
      <h2>Lista de Servi√ßos</h2>
      <table id="servicosTableList">
        <thead>
          <tr><th>ID</th><th>Categoria</th><th>Servi√ßo</th><th>Pre√ßo</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===================== PEDIDOS ===================== -->
    <section id="pedidos" class="hidden">
      <h1>Pedidos</h1>
      <form id="pedidoForm">
        <div class="form-group"><label>Cliente</label><select id="clientePedido" required></select></div>

        <h3>Servi√ßos</h3>
        <table id="servicosTable">
          <thead><tr><th>Categoria</th><th>Servi√ßo</th><th>Qtd</th><th>Valor Unit.</th><th>Subtotal</th><th>A√ß√µes</th></tr></thead>
          <tbody></tbody>
        </table>
        <button type="button" class="btn-add" onclick="addServicoItem()">‚ûï Servi√ßo</button>

        <h3>Produtos</h3>
        <table id="produtosTablePedido">
          <thead><tr><th>Categoria</th><th>Produto</th><th>Qtd</th><th>Valor Unit.</th><th>Subtotal</th><th>A√ß√µes</th></tr></thead>
          <tbody></tbody>
        </table>
        <button type="button" class="btn-add" onclick="addProdutoItem()">‚ûï Produto</button>

        <h3>Totais</h3>
        <p>Servi√ßos: R$ <span id="totalServicos">0,00</span></p>
        <p>Produtos: R$ <span id="totalProdutos">0,00</span></p>
        <p><strong>Total: R$ <span id="totalPedido">0,00</span></strong></p>
        <button type="submit" class="btn-add">üíæ Salvar Pedido</button>
      </form>

      <h2>Lista de Pedidos</h2>
      <table id="pedidosTable">
        <thead>
          <tr><th>ID</th><th>Cliente</th><th>Total</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===================== LAUDOS ===================== -->
    <section id="laudos" class="hidden">
      <h1>Laudos</h1>
      <form id="laudoForm">
        <div class="form-group"><label>Pedido</label><select id="pedidoLaudo" required></select></div>
        <div class="form-group"><label>Tipo</label><input type="text" id="tipoLaudo" required></div>
        <div class="form-group"><label>T√≠tulo</label><input type="text" id="tituloLaudo" required></div>
        <button type="submit" class="btn-add">‚ûï Adicionar Laudo</button>
      </form>
      <h2>Lista de Laudos</h2>
      <table id="laudosTable">
        <thead>
          <tr><th>ID</th><th>Pedido</th><th>Tipo</th><th>T√≠tulo</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===================== EQUIPE ===================== -->
    <section id="equipe" class="hidden">
      <h1>Equipe</h1>
      <form id="equipeForm">
        <div class="form-group"><label>Nome</label><input type="text" id="nomeEquipe" required></div>
        <div class="form-group"><label>Fun√ß√£o</label><input type="text" id="funcaoEquipe"></div>
        <button type="submit" class="btn-add">‚ûï Adicionar Membro</button>
      </form>
      <h2>Equipe</h2>
      <table id="equipeTable">
        <thead>
          <tr><th>ID</th><th>Nome</th><th>Fun√ß√£o</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===================== AGENDAMENTOS ===================== -->
    <section id="agendamentos" class="hidden">
      <h1>Agendamentos</h1>
      <form id="agendamentoForm">
        <div class="form-group"><label>Pedido</label><select id="pedidoAgendamento" required></select></div>
        <div class="form-group"><label>Data</label><input type="date" id="dataAgendamento" required></div>
        <div class="form-group"><label>Hora</label><input type="time" id="horaAgendamento" required></div>
        <button type="submit" class="btn-add">‚ûï Adicionar Agendamento</button>
      </form>
      <h2>Lista de Agendamentos</h2>
      <table id="agendamentosTable">
        <thead>
          <tr><th>ID</th><th>Pedido</th><th>Data</th><th>Hora</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
    <!-- ===================== MODAL DE DETALHES ===================== -->
    <div id="modalOverlay" class="hidden" style="
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center;
    ">
      <div id="modalBox" style="
        background:#fff; padding:20px; border-radius:8px; max-width:500px; width:90%;
        box-shadow:0 0 15px rgba(0,0,0,0.3); position:relative;
      ">
        <h2 id="modalTitle">Detalhes</h2>
        <div id="modalContent"></div>
        <button onclick="fecharModal()" style="
          margin-top:15px; background:#2f3542; color:#fff; padding:8px 14px; border:none; border-radius:4px; cursor:pointer;
        ">Fechar</button>
      </div>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  /* ------------------ Navega√ß√£o ------------------ */
  const navLinks = document.querySelectorAll('nav a[data-page]');
  const sections = document.querySelectorAll('main section');

  function showPage(page) {
    sections.forEach(s => s.id === page ? s.classList.remove('hidden') : s.classList.add('hidden'));
    navLinks.forEach(l => l.dataset.page === page ? l.classList.add('active') : l.classList.remove('active'));
    refreshDropdowns();
  }
  navLinks.forEach(l => l.addEventListener('click', e => { e.preventDefault(); showPage(l.dataset.page); }));

  /* ------------------ Estado / Storage ------------------ */
  const data = {
    clientes: JSON.parse(localStorage.getItem('clientes') || '[]'),
    produtos: JSON.parse(localStorage.getItem('produtos') || '[]'),
    servicos: JSON.parse(localStorage.getItem('servicos') || '[]'),
    pedidos: JSON.parse(localStorage.getItem('pedidos') || '[]'),
    laudos: JSON.parse(localStorage.getItem('laudos') || '[]'),
    equipe: JSON.parse(localStorage.getItem('equipe') || '[]'),
    agendamentos: JSON.parse(localStorage.getItem('agendamentos') || '[]'),
  };
  const saveAll = () => Object.keys(data).forEach(k => localStorage.setItem(k, JSON.stringify(data[k])));
  const nextId = arr => arr.length ? Math.max(...arr.map(x => x.id || 0)) + 1 : 1;
  const byId = (arr, id) => arr.find(x => x.id === id);
  const BRL = v => (Number(v)||0).toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});

  /* ------------------ Modal ------------------ */
  const overlay = document.getElementById('modalOverlay');
  const modalTitle = document.getElementById('modalTitle');
  const modalContent = document.getElementById('modalContent');
  window.abrirModal = (titulo, html) => {
    modalTitle.textContent = titulo;
    modalContent.innerHTML = html;
    overlay.classList.remove('hidden');
  };
  window.fecharModal = () => overlay.classList.add('hidden');
  overlay.addEventListener('click', (e) => { if (e.target === overlay) fecharModal(); });

  /* ------------------ Dropdowns dependentes ------------------ */
  function refreshDropdowns() {
    const selCliente = document.getElementById("clientePedido");
    if (selCliente) {
      selCliente.innerHTML = data.clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join("");
    }
    const selPedidoLaudo = document.getElementById("pedidoLaudo");
    if (selPedidoLaudo) {
      selPedidoLaudo.innerHTML = data.pedidos.map(p => `<option value="${p.id}">#${p.id} - ${byId(data.clientes,p.clienteId)?.nome || '‚Äî'}</option>`).join("");
    }
    const selPedidoAg = document.getElementById("pedidoAgendamento");
    if (selPedidoAg) {
      selPedidoAg.innerHTML = data.pedidos.map(p => `<option value="${p.id}">#${p.id} - ${byId(data.clientes,p.clienteId)?.nome || '‚Äî'}</option>`).join("");
    }
  }

  /* ------------------ Utilidades externas ------------------ */
  window.openMap = endereco => window.open(`https://www.google.com/maps/search/?api=1&query=${endereco}`, "_blank");
  window.openWhatsApp = telRaw => {
    const digits = decodeURIComponent(telRaw).replace(/\D/g,'');
    window.open(`https://wa.me/${digits}`, "_blank");
  };
  /* ------------------ Clientes ------------------ */
  let clienteEmEdicao = null;

  function renderClientes() {
    const tbody = document.querySelector("#clientesTable tbody");
    tbody.innerHTML = data.clientes.map(c => `
      <tr onclick="verDetalhesCliente(${c.id})">
        <td>${c.id}</td>
        <td>${c.nome}</td>
        <td>${c.email || ''}</td>
        <td>${c.telefone || ''}</td>
        <td>${c.endereco || ''}</td>
        <td>${c.complemento || ''}</td>
        <td><button type="button" class="btn-map" onclick="event.stopPropagation();openMap('${encodeURIComponent(c.endereco)}')">üó∫Ô∏è</button></td>
        <td><button type="button" class="btn-whatsapp" onclick="event.stopPropagation();openWhatsApp('${encodeURIComponent(c.telefone)}')">üì±</button></td>
        <td>
          <button type="button" class="btn-edit" onclick="event.stopPropagation();editarCliente(${c.id})">‚úèÔ∏è</button>
          <button type="button" class="btn-delete" onclick="event.stopPropagation();deletarCliente(${c.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join("");
    refreshDropdowns();
  }

  document.getElementById("clienteForm").onsubmit = e => {
    e.preventDefault();
    const novo = {
      nome: e.target.nome.value,
      email: e.target.email.value,
      telefone: e.target.telefone.value,
      endereco: e.target.endereco.value,
      complemento: e.target.complemento.value,
    };
    if (clienteEmEdicao) {
      const idx = data.clientes.findIndex(c => c.id === clienteEmEdicao);
      if (idx !== -1) data.clientes[idx] = { ...data.clientes[idx], ...novo };
      clienteEmEdicao = null;
      e.target.querySelector("button").textContent = "‚ûï Adicionar Cliente";
    } else {
      novo.id = nextId(data.clientes);
      data.clientes.push(novo);
    }
    saveAll(); e.target.reset(); renderClientes();
  };

  window.editarCliente = id => {
    const c = byId(data.clientes, id);
    if (!c) return;
    document.getElementById('nome').value = c.nome;
    document.getElementById('email').value = c.email;
    document.getElementById('telefone').value = c.telefone;
    document.getElementById('endereco').value = c.endereco;
    document.getElementById('complemento').value = c.complemento;
    clienteEmEdicao = c.id;
    document.getElementById("clienteForm").querySelector("button").textContent = "üíæ Salvar Altera√ß√µes";
    showPage("clientes");
  };

  window.deletarCliente = id => {
    if (confirm("Deseja excluir este cliente?")) {
      data.clientes = data.clientes.filter(c => c.id !== id);
      saveAll(); renderClientes();
    }
  };

  window.verDetalhesCliente = id => {
    const c = byId(data.clientes, id);
    if (!c) return;
    let pedidosDoCliente = data.pedidos.filter(p => p.clienteId === c.id);
    let listaPedidos = pedidosDoCliente.length
      ? "<ul>" + pedidosDoCliente.map(p => `<li>Pedido #${p.id} - Total R$ ${BRL(p.total)}</li>`).join("") + "</ul>"
      : "<em>Nenhum pedido</em>";
    abrirModal("Detalhes do Cliente", `
      <p><strong>Nome:</strong> ${c.nome}</p>
      <p><strong>Email:</strong> ${c.email || '‚Äî'}</p>
      <p><strong>Telefone:</strong> ${c.telefone || '‚Äî'}</p>
      <p><strong>Endere√ßo:</strong> ${c.endereco || '‚Äî'}</p>
      <p><strong>Complemento:</strong> ${c.complemento || '‚Äî'}</p>
      <h3>Pedidos</h3>${listaPedidos}
    `);
  };
  /* ------------------ Produtos ------------------ */
  let produtoEmEdicao = null;

  function renderProdutos() {
    const tbody = document.querySelector("#produtosTable tbody");
    tbody.innerHTML = data.produtos.map(p => `
      <tr onclick="verDetalhesProduto(${p.id})">
        <td>${p.id}</td>
        <td>${p.categoria}</td>
        <td>${p.nome}</td>
        <td>R$ ${BRL(p.preco)}</td>
        <td>
          <button type="button" class="btn-edit" onclick="event.stopPropagation();editarProduto(${p.id})">‚úèÔ∏è</button>
          <button type="button" class="btn-delete" onclick="event.stopPropagation();deletarProduto(${p.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join("");
  }

  document.getElementById("produtoForm").onsubmit = e => {
    e.preventDefault();
    const novo = {
      categoria: e.target.categoriaProduto.value,
      nome: e.target.nomeProduto.value,
      preco: parseFloat(e.target.precoProduto.value)
    };
    if (produtoEmEdicao) {
      const idx = data.produtos.findIndex(p => p.id === produtoEmEdicao);
      if (idx !== -1) data.produtos[idx] = { ...data.produtos[idx], ...novo };
      produtoEmEdicao = null;
      e.target.querySelector("button").textContent = "‚ûï Adicionar Produto";
    } else {
      novo.id = nextId(data.produtos);
      data.produtos.push(novo);
    }
    saveAll(); e.target.reset(); renderProdutos();
  };

  window.editarProduto = id => {
    const p = byId(data.produtos, id);
    if (!p) return;
    document.getElementById('categoriaProduto').value = p.categoria;
    document.getElementById('nomeProduto').value = p.nome;
    document.getElementById('precoProduto').value = p.preco;
    produtoEmEdicao = p.id;
    document.querySelector("#produtoForm button").textContent = "üíæ Salvar Altera√ß√µes";
    showPage("produtos");
  };

  window.deletarProduto = id => {
    if (confirm("Deseja excluir este produto?")) {
      data.produtos = data.produtos.filter(p => p.id !== id);
      saveAll(); renderProdutos();
    }
  };

  window.verDetalhesProduto = id => {
    const p = byId(data.produtos, id);
    if (!p) return;
    abrirModal("Detalhes do Produto", `
      <p><strong>Categoria:</strong> ${p.categoria}</p>
      <p><strong>Nome:</strong> ${p.nome}</p>
      <p><strong>Pre√ßo:</strong> R$ ${BRL(p.preco)}</p>
    `);
  };
  /* ------------------ Servi√ßos ------------------ */
  let servicoEmEdicao = null;

  function renderServicos() {
    const tbody = document.querySelector("#servicosTableList tbody");
    tbody.innerHTML = data.servicos.map(s => `
      <tr onclick="verDetalhesServico(${s.id})">
        <td>${s.id}</td>
        <td>${s.categoria}</td>
        <td>${s.nome}</td>
        <td>R$ ${BRL(s.preco)}</td>
        <td>
          <button type="button" class="btn-edit" onclick="event.stopPropagation();editarServico(${s.id})">‚úèÔ∏è</button>
          <button type="button" class="btn-delete" onclick="event.stopPropagation();deletarServico(${s.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join("");
  }

  document.getElementById("servicoForm").onsubmit = e => {
    e.preventDefault();
    const novo = {
      categoria: e.target.categoriaServico.value,
      nome: e.target.nomeServico.value,
      preco: parseFloat(e.target.precoServico.value)
    };
    if (servicoEmEdicao) {
      const idx = data.servicos.findIndex(s => s.id === servicoEmEdicao);
      if (idx !== -1) data.servicos[idx] = { ...data.servicos[idx], ...novo };
      servicoEmEdicao = null;
      e.target.querySelector("button").textContent = "‚ûï Adicionar Servi√ßo";
    } else {
      novo.id = nextId(data.servicos);
      data.servicos.push(novo);
    }
    saveAll(); e.target.reset(); renderServicos();
  };

  window.editarServico = id => {
    const s = byId(data.servicos, id);
    if (!s) return;
    document.getElementById('categoriaServico').value = s.categoria;
    document.getElementById('nomeServico').value = s.nome;
    document.getElementById('precoServico').value = s.preco;
    servicoEmEdicao = s.id;
    document.querySelector("#servicoForm button").textContent = "üíæ Salvar Altera√ß√µes";
    showPage("servicos");
  };

  window.deletarServico = id => {
    if (confirm("Deseja excluir este servi√ßo?")) {
      data.servicos = data.servicos.filter(s => s.id !== id);
      saveAll(); renderServicos();
    }
  };

  window.verDetalhesServico = id => {
    const s = byId(data.servicos, id);
    if (!s) return;
    abrirModal("Detalhes do Servi√ßo", `
      <p><strong>Categoria:</strong> ${s.categoria}</p>
      <p><strong>Nome:</strong> ${s.nome}</p>
      <p><strong>Pre√ßo:</strong> R$ ${BRL(s.preco)}</p>
    `);
  };
  /* ------------------ Pedidos ------------------ */
  let pedidoEmEdicao = null;

  function renderPedidos() {
    const tbody = document.querySelector("#pedidosTable tbody");
    tbody.innerHTML = data.pedidos.map(p => `
      <tr onclick="verDetalhesPedido(${p.id})">
        <td>${p.id}</td>
        <td>${byId(data.clientes, p.clienteId)?.nome || '‚Äî'}</td>
        <td>R$ ${BRL(p.total)}</td>
        <td>
          <button type="button" class="btn-edit" onclick="event.stopPropagation();editarPedido(${p.id})">‚úèÔ∏è</button>
          <button type="button" class="btn-delete" onclick="event.stopPropagation();deletarPedido(${p.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join("");
    refreshDropdowns();
  }

  // Adicionar linha de item (gen√©rico p/ produtos e servi√ßos)
  function adicionarItem(tableId, catalog) {
    const tbody = document.getElementById(tableId).querySelector('tbody');
    const optionEls = catalog.map(x => `<option value="${x.id}">${x.nome}</option>`).join('');
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
      <td></td>
      <td><select>${optionEls}</select></td>
      <td><input type="number" min="1" value="1" /></td>
      <td><input type="number" step="0.01" readonly /></td>
      <td><input type="number" step="0.01" readonly /></td>
      <td><button type="button" onclick="this.closest('tr').remove();calcTotals();">‚ùå</button></td>
    `;
    tbody.appendChild(newRow);
    const select = newRow.querySelector('select');
    select.onchange = () => {
      const item = catalog.find(x => x.id == select.value);
      newRow.cells[0].textContent = item?.categoria || '';
      newRow.cells[3].querySelector('input').value = item?.preco.toFixed(2);
      calcTotals();
    };
    select.dispatchEvent(new Event('change'));
    newRow.cells[2].querySelector('input').oninput = calcTotals;
  }
  window.addProdutoItem = () => adicionarItem('produtosTablePedido', data.produtos);
  window.addServicoItem = () => adicionarItem('servicosTable', data.servicos);

  function calcTotals() {
    ['servicosTable','produtosTablePedido'].forEach((tid, idx) => {
      const total = Array.from(document.getElementById(tid).querySelectorAll('tbody tr')).reduce((sum,tr)=>{
        const qty = parseFloat(tr.cells[2].querySelector('input').value)||0;
        const price = parseFloat(tr.cells[3].querySelector('input').value)||0;
        tr.cells[4].querySelector('input').value = (qty*price).toFixed(2);
        return sum+(qty*price);
      },0);
      document.getElementById(idx===0?'totalServicos':'totalProdutos').textContent = BRL(total);
    });
    const s = parseFloat(document.getElementById('totalServicos').textContent.replace(/\./g,'').replace(',','.'))||0;
    const p = parseFloat(document.getElementById('totalProdutos').textContent.replace(/\./g,'').replace(',','.'))||0;
    document.getElementById('totalPedido').textContent = BRL(s+p);
  }

  document.getElementById("pedidoForm").onsubmit = e => {
    e.preventDefault();
    const clienteId = parseInt(e.target.clientePedido.value);
    const itensServ = Array.from(document.querySelector("#servicosTable tbody").children).map(tr => ({
      id: parseInt(tr.cells[1].querySelector('select').value),
      qtd: parseInt(tr.cells[2].querySelector('input').value),
      preco: parseFloat(tr.cells[3].querySelector('input').value)
    }));
    const itensProd = Array.from(document.querySelector("#produtosTablePedido tbody").children).map(tr => ({
      id: parseInt(tr.cells[1].querySelector('select').value),
      qtd: parseInt(tr.cells[2].querySelector('input').value),
      preco: parseFloat(tr.cells[3].querySelector('input').value)
    }));
    const total = parseFloat(document.getElementById('totalPedido').textContent.replace(/\./g,'').replace(',','.'))||0;

    if (pedidoEmEdicao) {
      const idx = data.pedidos.findIndex(p=>p.id===pedidoEmEdicao);
      if (idx!==-1) data.pedidos[idx] = { id: pedidoEmEdicao, clienteId, itensServ, itensProd, total };
      pedidoEmEdicao = null;
    } else {
      data.pedidos.push({ id: nextId(data.pedidos), clienteId, itensServ, itensProd, total });
    }
    saveAll(); renderPedidos(); e.target.reset();
    document.querySelector("#servicosTable tbody").innerHTML='';
    document.querySelector("#produtosTablePedido tbody").innerHTML='';
    calcTotals();
  };

  window.editarPedido = id => {
    const p = byId(data.pedidos, id);
    if (!p) return;
    document.getElementById("clientePedido").value = p.clienteId;
    pedidoEmEdicao = p.id;
    // carregar itens
    document.querySelector("#servicosTable tbody").innerHTML='';
    p.itensServ.forEach(()=>addServicoItem());
    p.itensServ.forEach((it,i)=>{
      const row=document.querySelector("#servicosTable tbody").rows[i];
      row.cells[1].querySelector('select').value = it.id;
      row.cells[2].querySelector('input').value = it.qtd;
      row.cells[3].querySelector('input').value = it.preco;
      row.cells[4].querySelector('input').value = (it.qtd*it.preco).toFixed(2);
    });
    document.querySelector("#produtosTablePedido tbody").innerHTML='';
    p.itensProd.forEach(()=>addProdutoItem());
    p.itensProd.forEach((it,i)=>{
      const row=document.querySelector("#produtosTablePedido tbody").rows[i];
      row.cells[1].querySelector('select').value = it.id;
      row.cells[2].querySelector('input').value = it.qtd;
      row.cells[3].querySelector('input').value = it.preco;
      row.cells[4].querySelector('input').value = (it.qtd*it.preco).toFixed(2);
    });
    calcTotals();
    showPage("pedidos");
  };

  window.deletarPedido = id => {
    if (confirm("Deseja excluir este pedido?")) {
      data.pedidos = data.pedidos.filter(p => p.id !== id);
      saveAll(); renderPedidos();
    }
  };

  window.verDetalhesPedido = id => {
    const p = byId(data.pedidos,id);
    if (!p) return;
    const cliente = byId(data.clientes,p.clienteId);
    let html = `<p><strong>Cliente:</strong> ${cliente?.nome||'‚Äî'}</p>`;
    html += "<h3>Servi√ßos</h3>";
    html += p.itensServ.length?("<ul>"+p.itensServ.map(it=>{
      const s = byId(data.servicos,it.id); return `<li>${s?.nome} (${it.qtd} x R$${BRL(it.preco)})</li>`;
    }).join("")+"</ul>"):"<em>‚Äî</em>";
    html += "<h3>Produtos</h3>";
    html += p.itensProd.length?("<ul>"+p.itensProd.map(it=>{
      const pr = byId(data.produtos,it.id); return `<li>${pr?.nome} (${it.qtd} x R$${BRL(it.preco)})</li>`;
    }).join("")+"</ul>"):"<em>‚Äî</em>";
    html += `<h3>Total:</h3><p>R$ ${BRL(p.total)}</p>`;
    abrirModal("Detalhes do Pedido", html);
  };
  /* ------------------ Laudos ------------------ */
  let laudoEmEdicao = null;

  function renderLaudos() {
    const tbody = document.querySelector("#laudosTable tbody");
    tbody.innerHTML = data.laudos.map(l => `
      <tr onclick="verDetalhesLaudo(${l.id})">
        <td>${l.id}</td>
        <td>#${l.pedidoId}</td>
        <td>${l.tipo}</td>
        <td>${l.titulo}</td>
        <td>
          <button type="button" class="btn-edit" onclick="event.stopPropagation();editarLaudo(${l.id})">‚úèÔ∏è</button>
          <button type="button" class="btn-delete" onclick="event.stopPropagation();deletarLaudo(${l.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join("");
    refreshDropdowns();
  }

  document.getElementById("laudoForm").onsubmit = e => {
    e.preventDefault();
    const novo = {
      pedidoId: parseInt(e.target.pedidoLaudo.value),
      tipo: e.target.tipoLaudo.value,
      titulo: e.target.tituloLaudo.value
    };
    if (laudoEmEdicao) {
      const idx = data.laudos.findIndex(l=>l.id===laudoEmEdicao);
      if (idx!==-1) data.laudos[idx] = { ...data.laudos[idx], id: laudoEmEdicao, ...novo };
      laudoEmEdicao=null;
      e.target.querySelector("button").textContent="‚ûï Salvar Laudo";
    } else {
      novo.id = nextId(data.laudos);
      data.laudos.push(novo);
    }
    saveAll(); renderLaudos(); e.target.reset();
  };

  window.editarLaudo = id => {
    const l = byId(data.laudos,id); if(!l) return;
    document.getElementById("pedidoLaudo").value = l.pedidoId;
    document.getElementById("tipoLaudo").value = l.tipo;
    document.getElementById("tituloLaudo").value = l.titulo;
    laudoEmEdicao = l.id;
    document.querySelector("#laudoForm button").textContent = "üíæ Salvar Altera√ß√µes";
    showPage("laudos");
  };

  window.deletarLaudo = id => {
    if (confirm("Deseja excluir este laudo?")) {
      data.laudos = data.laudos.filter(l=>l.id!==id);
      saveAll(); renderLaudos();
    }
  };

  window.verDetalhesLaudo = id => {
    const l = byId(data.laudos,id); if(!l) return;
    const pedido = byId(data.pedidos,l.pedidoId);
    abrirModal("Detalhes do Laudo", `
      <p><strong>Pedido:</strong> #${pedido?.id || '‚Äî'}</p>
      <p><strong>Tipo:</strong> ${l.tipo}</p>
      <p><strong>T√≠tulo:</strong> ${l.titulo}</p>
    `);
  };
  /* ------------------ Equipe ------------------ */
  let equipeEmEdicao = null;

  function renderEquipe() {
    const tbody = document.querySelector("#equipeTable tbody");
    tbody.innerHTML = data.equipe.map(e => `
      <tr onclick="verDetalhesEquipe(${e.id})">
        <td>${e.id}</td>
        <td>${e.nome}</td>
        <td>${e.funcao}</td>
        <td>
          <button type="button" class="btn-edit" onclick="event.stopPropagation();editarEquipe(${e.id})">‚úèÔ∏è</button>
          <button type="button" class="btn-delete" onclick="event.stopPropagation();deletarEquipe(${e.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join("");
  }

  document.getElementById("equipeForm").onsubmit = e => {
    e.preventDefault();
    const novo = {
      nome: e.target.nomeEquipe.value,
      funcao: e.target.funcaoEquipe.value
    };
    if (equipeEmEdicao) {
      const idx = data.equipe.findIndex(x=>x.id===equipeEmEdicao);
      if (idx!==-1) data.equipe[idx] = { ...data.equipe[idx], ...novo };
      equipeEmEdicao=null;
      e.target.querySelector("button").textContent="‚ûï Adicionar";
    } else {
      novo.id = nextId(data.equipe);
      data.equipe.push(novo);
    }
    saveAll(); renderEquipe(); e.target.reset();
  };

  window.editarEquipe = id => {
    const e = byId(data.equipe,id); if(!e) return;
    document.getElementById("nomeEquipe").value = e.nome;
    document.getElementById("funcaoEquipe").value = e.funcao;
    equipeEmEdicao = e.id;
    document.querySelector("#equipeForm button").textContent = "üíæ Salvar Altera√ß√µes";
    showPage("equipe");
  };

  window.deletarEquipe = id => {
    if (confirm("Deseja excluir este membro da equipe?")) {
      data.equipe = data.equipe.filter(x=>x.id!==id);
      saveAll(); renderEquipe();
    }
  };

  window.verDetalhesEquipe = id => {
    const e = byId(data.equipe,id); if(!e) return;
    abrirModal("Detalhes da Equipe", `
      <p><strong>Nome:</strong> ${e.nome}</p>
      <p><strong>Fun√ß√£o:</strong> ${e.funcao}</p>
    `);
  };
  /* ------------------ Agendamentos ------------------ */
  let agendamentoEmEdicao = null;

  function renderAgendamentos() {
    const tbody = document.querySelector("#agendamentosTable tbody");
    tbody.innerHTML = data.agendamentos.map(a => `
      <tr onclick="verDetalhesAgendamento(${a.id})">
        <td>${a.id}</td>
        <td>#${a.pedidoId}</td>
        <td>${a.data}</td>
        <td>${a.hora}</td>
        <td>
          <button type="button" class="btn-edit" onclick="event.stopPropagation();editarAgendamento(${a.id})">‚úèÔ∏è</button>
          <button type="button" class="btn-delete" onclick="event.stopPropagation();deletarAgendamento(${a.id})">üóëÔ∏è</button>
        </td>
      </tr>
    `).join("");
    refreshDropdowns();
  }

  document.getElementById("agendamentoForm").onsubmit = e => {
    e.preventDefault();
    const novo = {
      pedidoId: parseInt(e.target.pedidoAgendamento.value),
      data: e.target.dataAgendamento.value,
      hora: e.target.horaAgendamento.value
    };
    if (agendamentoEmEdicao) {
      const idx = data.agendamentos.findIndex(x=>x.id===agendamentoEmEdicao);
      if (idx!==-1) data.agendamentos[idx] = { ...data.agendamentos[idx], id: agendamentoEmEdicao, ...novo };
      agendamentoEmEdicao=null;
      e.target.querySelector("button").textContent="‚ûï Salvar Agendamento";
    } else {
      novo.id = nextId(data.agendamentos);
      data.agendamentos.push(novo);
    }
    saveAll(); renderAgendamentos(); e.target.reset();
  };

  window.editarAgendamento = id => {
    const a = byId(data.agendamentos,id); if(!a) return;
    document.getElementById("pedidoAgendamento").value = a.pedidoId;
    document.getElementById("dataAgendamento").value = a.data;
    document.getElementById("horaAgendamento").value = a.hora;
    agendamentoEmEdicao = a.id;
    document.querySelector("#agendamentoForm button").textContent = "üíæ Salvar Altera√ß√µes";
    showPage("agendamentos");
  };

  window.deletarAgendamento = id => {
    if (confirm("Deseja excluir este agendamento?")) {
      data.agendamentos = data.agendamentos.filter(x=>x.id!==id);
      saveAll(); renderAgendamentos();
    }
  };

  window.verDetalhesAgendamento = id => {
    const a = byId(data.agendamentos,id); if(!a) return;
    const pedido = byId(data.pedidos,a.pedidoId);
    abrirModal("Detalhes do Agendamento", `
      <p><strong>Pedido:</strong> #${pedido?.id || '‚Äî'}</p>
      <p><strong>Data:</strong> ${a.data}</p>
      <p><strong>Hora:</strong> ${a.hora}</p>
    `);
  };

  /* ------------------ Inicializa√ß√£o ------------------ */
  renderClientes();
  renderProdutos();
  renderServicos();
  renderPedidos();
  renderLaudos();
  renderEquipe();
  renderAgendamentos();
  showPage('painel');
  // fecha o document.addEventListener("DOMContentLoaded", ...)
});
</script>
</main>

<!-- Script do Google Maps para autocomplete -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBpcuXY6YfNTIwFAG-yFdvwUrX0mjwuOc&libraries=places&callback=initAutocomplete" async defer></script>
</body>
</html> 
